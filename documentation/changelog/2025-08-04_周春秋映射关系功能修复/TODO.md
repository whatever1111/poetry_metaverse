# 周春秋映射关系功能修复 TODO

## 问题描述
周春秋项目中管理后台的映射关系功能不生效，用户无法查看和修改映射关系。

## 问题分析
1. **API端点缺失**：服务器端缺少 `/api/mappings` 的PUT端点
2. **数据结构不匹配**：草稿区映射关系数据结构与API期望不匹配
3. **认证问题**：管理后台API请求缺少 `credentials: 'include'`
4. **环境配置缺失**：缺少 `.env` 文件导致服务器无法启动
5. **数据格式不一致**：映射关系中使用书名号，但诗歌文件名没有书名号

## 修复任务

### ✅ 服务器端修复
- [x] 添加 `/api/mappings` PUT端点
- [x] 修复草稿区映射关系数据结构读取逻辑
- [x] 修复映射关系保存API的数据结构处理
- [x] 创建 `.env` 环境配置文件

### ✅ 前端修复
- [x] 添加 `credentials: 'include'` 支持
- [x] 移除书名号处理逻辑
- [x] 简化映射关系匹配和保存逻辑

### ✅ 数据文件修复
- [x] 统一移除映射关系中的书名号
- [x] 确保线上线下数据格式一致

### ✅ 项目清理
- [x] 移动废弃的 `admin.js` 文件到 `archive/` 目录
- [x] 移动废弃的 `admin-styles.css` 文件到 `archive/` 目录
- [x] 创建 `archive/README.md` 说明废弃原因

## 验证任务
- [x] 验证映射关系API正常工作
- [x] 验证管理后台可以正确显示映射关系
- [x] 验证可以修改和保存映射关系
- [x] 验证数据格式完全统一
- [x] 验证认证机制正常工作
- [x] 验证服务器稳定运行

## 经验总结
1. **数据一致性原则**：所有相关数据要使用统一的格式
2. **API设计经验**：确保前端调用的API端点在后端有对应实现
3. **认证机制**：需要认证的API要正确配置credentials
4. **环境配置**：项目依赖的环境变量要完整配置
5. **调试技巧**：使用日志记录API调用情况
6. **代码维护**：及时清理废弃的文件和代码

## 后续优化建议
- [ ] 添加更完善的错误处理
- [ ] 增加数据验证和错误检查
- [ ] 考虑添加映射关系的批量操作功能
- [ ] 将修复经验应用到其他项目分支 